{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useRef, useEffect } from \"react\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport { Avatar, Button, TextInput, TouchableRipple } from \"react-native-paper\";\nimport Gap from \"../../componnetns/Gap\";\nimport ListMeassges from \"../../componnetns/ListMeassges\";\nimport { styles } from \"../../style/style\";\nimport EmojiSelector, { Categories } from \"react-native-emoji-selector\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport LottieView from \"lottie-react-native\";\nimport { Audio } from \"expo-av\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { PSUT_ChatroomApi } from \"../../api/routeApi\";\nimport { Cache } from \"../../helpers/cache\";\nimport bg from \"../../assets/chat_bg.png\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar Player = new Audio.Sound();\n\nvar Meassging = function Meassging(_ref) {\n  var _route$params;\n\n  var route = _ref.route;\n  var nav = useNavigation();\n  if (!(route != null && (_route$params = route.params) != null && _route$params.conversationId)) nav.goBack();\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      messagesState = _useState2[0],\n      setMessagesState = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      showEmoji = _useState4[0],\n      setShowEmoji = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      _useState6 = _slicedToArray(_useState5, 2),\n      emojiSelected = _useState6[0],\n      setEmojiSelected = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      _useState8 = _slicedToArray(_useState7, 2),\n      textMeassging = _useState8[0],\n      setTextMeassging = _useState8[1];\n\n  var _useState9 = useState(null),\n      _useState10 = _slicedToArray(_useState9, 2),\n      image = _useState10[0],\n      setImage = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      onRecored = _useState12[0],\n      setOnRecored = _useState12[1];\n\n  var _useState13 = useState(false),\n      _useState14 = _slicedToArray(_useState13, 2),\n      visible = _useState14[0],\n      setVisible = _useState14[1];\n\n  var _useState15 = useState(null),\n      _useState16 = _slicedToArray(_useState15, 2),\n      recoredFile = _useState16[0],\n      setRecoredFile = _useState16[1];\n\n  var _useState17 = useState(null),\n      _useState18 = _slicedToArray(_useState17, 2),\n      recoredingUrl = _useState18[0],\n      setRecoredingUrl = _useState18[1];\n\n  var flatRef = useRef(null);\n\n  var onChange = function onChange(text) {\n    setTextMeassging(text);\n  };\n\n  useEffect(function () {\n    setTextMeassging(function (pre) {\n      return pre + emojiSelected;\n    });\n  }, [emojiSelected]);\n\n  var showModal = function showModal() {\n    return setVisible(true);\n  };\n\n  var hideModal = function hideModal() {\n    return setVisible(false);\n  };\n\n  var timerRef = useRef(null);\n  useEffect(function () {\n    getMessages();\n    timerRef.current = setInterval(function () {\n      return getMessages();\n    }, 4000);\n    return function () {\n      return clearInterval(timerRef.current);\n    };\n  }, []);\n\n  var getMessages = function getMessages() {\n    var conversationId, messages, userId, data;\n    return _regeneratorRuntime.async(function getMessages$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            conversationId = route.params.conversationId;\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(PSUT_ChatroomApi.GetMessagesInConversation(conversationId));\n\n          case 4:\n            messages = _context.sent;\n            userId = Cache.userData.id;\n            data = messages.data.map(function (msg) {\n              return {\n                id: msg.id,\n                sender: msg.sender.name,\n                message: msg.content,\n                sendingTime: msg.sendingTime,\n                isMe: userId === msg.sender.id\n              };\n            });\n            if (messagesState.length !== data.length) setMessagesState(data);\n            _context.next = 13;\n            break;\n\n          case 10:\n            _context.prev = 10;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(_context.t0);\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 10]], Promise);\n  };\n\n  useEffect(function () {\n    scrollToIndex();\n  }, [messagesState]);\n\n  var getPickerPermissions = function getPickerPermissions() {\n    var _await$ImagePicker$re, status;\n\n    return _regeneratorRuntime.async(function getPickerPermissions$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(ImagePicker.requestMediaLibraryPermissionsAsync());\n\n          case 2:\n            _await$ImagePicker$re = _context2.sent;\n            status = _await$ImagePicker$re.status;\n\n            if (status !== \"granted\") {\n              Alert(\"تنبيه\", \"للتتمكن من استخدام اختيار الصور من المعرض يجب ان تعطي الصلاحيه للوصول\", [{\n                text: \"اعادة طلب الصلاحية\",\n                onPress: function onPress() {\n                  return getPickerPermissions();\n                },\n                style: \"default\"\n              }, {\n                text: \"حسنا\",\n                style: \"cancel\"\n              }], {\n                cancelable: false\n              });\n            } else pickImage();\n\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var pickImage = function pickImage() {\n    var result;\n    return _regeneratorRuntime.async(function pickImage$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n              mediaTypes: ImagePicker.MediaTypeOptions.All,\n              allowsEditing: false,\n              aspect: [4, 3],\n              quality: 1\n            }));\n\n          case 2:\n            result = _context3.sent;\n            console.log(result);\n\n            if (!result.cancelled) {\n              setImage(result.uri);\n            }\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var startVoiceRecording = function startVoiceRecording() {\n    var _await$Audio$Recordin, recording;\n\n    return _regeneratorRuntime.async(function startVoiceRecording$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            setOnRecored(true);\n            console.log(\"Requesting permissions..\");\n            _context4.next = 5;\n            return _regeneratorRuntime.awrap(Audio.requestPermissionsAsync());\n\n          case 5:\n            _context4.next = 7;\n            return _regeneratorRuntime.awrap(Audio.setAudioModeAsync({\n              allowsRecordingIOS: true,\n              playsInSilentModeIOS: true,\n              shouldDuckAndroid: true\n            }));\n\n          case 7:\n            console.log(\"Starting recording ....\");\n            _context4.next = 10;\n            return _regeneratorRuntime.awrap(Audio.Recording.createAsync(Audio.RECORDING_OPTIONS_PRESET_HIGH_QUALITY));\n\n          case 10:\n            _await$Audio$Recordin = _context4.sent;\n            recording = _await$Audio$Recordin.recording;\n            setRecoredFile(recording);\n            console.log(\"Recording started\");\n            _context4.next = 19;\n            break;\n\n          case 16:\n            _context4.prev = 16;\n            _context4.t0 = _context4[\"catch\"](0);\n            console.error(\"Failed to start recording\", _context4.t0);\n\n          case 19:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 16]], Promise);\n  };\n\n  var stopRecording = function stopRecording() {\n    var uri;\n    return _regeneratorRuntime.async(function stopRecording$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            setOnRecored(false);\n            _context5.next = 3;\n            return _regeneratorRuntime.awrap(recoredFile.stopAndUnloadAsync());\n\n          case 3:\n            uri = recoredFile.getURI();\n            setRecoredingUrl(uri);\n            showModal();\n            console.log(\"Recording stopped and stored at\", uri);\n\n          case 7:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var playSound = function playSound() {\n    var result, response;\n    return _regeneratorRuntime.async(function playSound$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.prev = 0;\n            _context6.next = 3;\n            return _regeneratorRuntime.awrap(Player.loadAsync({\n              uri: recoredingUrl\n            }, {}, true));\n\n          case 3:\n            result = _context6.sent;\n            _context6.next = 6;\n            return _regeneratorRuntime.awrap(Player.getStatusAsync());\n\n          case 6:\n            response = _context6.sent;\n            Player.setOnPlaybackStatusUpdate(function (status) {\n              if (status.didJustFinish) {\n                stopSound(recoredingUrl);\n              }\n            });\n\n            if (response.isLoaded) {\n              if (!response.isPlaying) Player.playAsync();\n            }\n\n            _context6.next = 14;\n            break;\n\n          case 11:\n            _context6.prev = 11;\n            _context6.t0 = _context6[\"catch\"](0);\n            console.log(_context6.t0);\n\n          case 14:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, [[0, 11]], Promise);\n  };\n\n  var stopSound = function stopSound() {\n    var stusts;\n    return _regeneratorRuntime.async(function stopSound$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            _context7.prev = 0;\n            _context7.next = 3;\n            return _regeneratorRuntime.awrap(Player.getStatusAsync());\n\n          case 3:\n            stusts = _context7.sent;\n            console.log(\"stusts\", stusts);\n\n            if (!stusts.isLoaded) {\n              _context7.next = 9;\n              break;\n            }\n\n            _context7.next = 8;\n            return _regeneratorRuntime.awrap(Player.pauseAsync());\n\n          case 8:\n            recoredingUrl ? Player.unloadAsync() : undefined;\n\n          case 9:\n            _context7.next = 14;\n            break;\n\n          case 11:\n            _context7.prev = 11;\n            _context7.t0 = _context7[\"catch\"](0);\n            console.log(_context7.t0);\n\n          case 14:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, null, null, [[0, 11]], Promise);\n  };\n\n  var onPressSend = function onPressSend() {\n    var time = new Date();\n    var data = {\n      id: Math.random(),\n      sender: \"Me\",\n      message: textMeassging,\n      sendingTime: \"T\" + time.getHours() + \":\" + time.getMinutes() + \":\" + time.getSeconds() + \".\",\n      isMe: true\n    };\n    var dto = {\n      content: textMeassging,\n      conversationId: route.params.conversationId\n    };\n    setMessagesState([].concat(_toConsumableArray(messagesState), [data]));\n    setTextMeassging(\"\");\n    scrollToIndex();\n    PSUT_ChatroomApi.sendMessage(dto);\n  };\n\n  var scrollToIndex = function scrollToIndex() {\n    if (messagesState.length - 1 < 0 || !flatRef.current) return;\n\n    try {\n      flatRef.current.scrollToIndex({\n        animated: true,\n        index: messagesState.length - 1\n      });\n    } catch (e) {}\n  };\n\n  return _jsxs(View, {\n    style: [styles.container, {\n      backgroundColor: \"#FFF\"\n    }],\n    children: [_jsx(Image, {\n      style: {\n        width: \"100%\",\n        height: \"100%\",\n        position: \"absolute\",\n        transform: [{\n          scale: 2\n        }]\n      },\n      resizeMethod: \"auto\",\n      resizeMode: \"repeat\",\n      source: bg\n    }), !!image ? _jsxs(View, {\n      style: {\n        flex: 1,\n        justifyContent: \"space-around\"\n      },\n      children: [_jsx(View, {\n        style: {\n          paddingHorizontal: 20,\n          display: \"flex\",\n          justifyContent: \"center\",\n          alignItems: \"center\"\n        },\n        children: _jsx(Image, {\n          style: {\n            width: 300,\n            height: 300\n          },\n          source: {\n            uri: \"\" + image\n          }\n        })\n      }), _jsx(View, {\n        style: {\n          paddingHorizontal: 20\n        },\n        children: _jsx(Button, {\n          mode: \"contained\",\n          theme: {\n            roundness: 10\n          },\n          labelStyle: {\n            fontFamily: \"AppNormal\"\n          },\n          contentStyle: styles.loginButton,\n          onPress: function onPress() {\n            return setImage(null);\n          },\n          children: \"\\u0627\\u0631\\u0633\\u0627\\u0644\"\n        })\n      })]\n    }) : _jsxs(React.Fragment, {\n      children: [_jsx(FlatList, {\n        ref: flatRef,\n        data: messagesState,\n        style: {\n          height: \"10%\"\n        },\n        renderItem: function renderItem(_ref2) {\n          var item = _ref2.item,\n              index = _ref2.index;\n          return _jsx(ListMeassges, {\n            item: item,\n            index: index\n          }, index);\n        },\n        keyExtractor: function keyExtractor(item, index) {\n          var _item$id$toString, _item$id;\n\n          return (_item$id$toString = item == null ? void 0 : (_item$id = item.id) == null ? void 0 : _item$id.toString()) != null ? _item$id$toString : index.toString();\n        }\n      }), _jsx(View, {\n        style: {\n          padding: 10,\n          justifyContent: \"flex-end\",\n          alignItems: \"baseline\"\n        },\n        children: _jsxs(View, {\n          style: styles.rowView,\n          children: [onRecored ? _jsx(View, {\n            style: {\n              width: \"80%\"\n            },\n            children: _jsx(LottieView, {\n              loop: true,\n              autoPlay: true,\n              speed: 0.65,\n              style: {\n                width: 100,\n                height: 100,\n                backgroundColor: \"white\"\n              },\n              source: require(\"../../assets/jsonfile/loadingRecord.json\")\n            })\n          }) : _jsx(TextInput, {\n            theme: {\n              roundness: 50\n            },\n            multiline: false,\n            mode: \"outlined\",\n            enablesReturnKeyAutomatically: true,\n            keyboardType: \"twitter\",\n            onChangeText: function onChangeText(text) {\n              return onChange(text);\n            },\n            value: textMeassging,\n            left: _jsx(TextInput.Icon, {\n              name: \"emoticon\",\n              onPress: function onPress() {\n                return setShowEmoji(function (prev) {\n                  return !prev;\n                });\n              },\n              color: \"gray\",\n              style: {\n                top: 5\n              }\n            }),\n            selectionColor: \"#128C7E\",\n            style: [styles.textInputstyle, {\n              width: \"85%\"\n            }]\n          }), _jsx(Gap, {\n            gapValue: \"3\",\n            type: \"row\"\n          }), _jsx(TouchableRipple, {\n            onPress: onPressSend,\n            children: _jsx(Avatar.Icon, {\n              style: {\n                top: 7\n              },\n              size: 45,\n              icon: \"arrow-right-thick\"\n            })\n          })]\n        })\n      })]\n    }), showEmoji && _jsx(EmojiSelector, {\n      showSearchBar: false,\n      showSectionTitles: false,\n      category: Categories.emotion,\n      onEmojiSelected: function onEmojiSelected(emoji) {\n        return setEmojiSelected(emoji);\n      }\n    })]\n  });\n};\n\nexport default Meassging;","map":{"version":3,"sources":["C:/Users/Ahmed/Desktop/UniChat/Mobile/screen/chatScreen/Meassging.js"],"names":["React","useState","useRef","useEffect","Avatar","Button","TextInput","TouchableRipple","Gap","ListMeassges","styles","EmojiSelector","Categories","ImagePicker","LottieView","Audio","useNavigation","PSUT_ChatroomApi","Cache","bg","Player","Sound","Meassging","route","nav","params","conversationId","goBack","messagesState","setMessagesState","showEmoji","setShowEmoji","emojiSelected","setEmojiSelected","textMeassging","setTextMeassging","image","setImage","onRecored","setOnRecored","visible","setVisible","recoredFile","setRecoredFile","recoredingUrl","setRecoredingUrl","flatRef","onChange","text","pre","showModal","hideModal","timerRef","getMessages","current","setInterval","clearInterval","GetMessagesInConversation","messages","userId","userData","id","data","map","msg","sender","name","message","content","sendingTime","isMe","length","console","log","scrollToIndex","getPickerPermissions","requestMediaLibraryPermissionsAsync","status","Alert","onPress","style","cancelable","pickImage","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","All","allowsEditing","aspect","quality","result","cancelled","uri","startVoiceRecording","requestPermissionsAsync","setAudioModeAsync","allowsRecordingIOS","playsInSilentModeIOS","shouldDuckAndroid","Recording","createAsync","RECORDING_OPTIONS_PRESET_HIGH_QUALITY","recording","error","stopRecording","stopAndUnloadAsync","getURI","playSound","loadAsync","getStatusAsync","response","setOnPlaybackStatusUpdate","didJustFinish","stopSound","isLoaded","isPlaying","playAsync","stusts","pauseAsync","unloadAsync","undefined","onPressSend","time","Date","Math","random","getHours","getMinutes","getSeconds","dto","sendMessage","animated","index","e","container","backgroundColor","width","height","position","transform","scale","flex","justifyContent","paddingHorizontal","display","alignItems","roundness","fontFamily","loginButton","item","toString","padding","rowView","require","prev","top","textInputstyle","emotion","emoji"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport { FlatList, View, Image } from \"react-native\";\nimport { Avatar, Button, TextInput, TouchableRipple } from \"react-native-paper\";\nimport Gap from \"../../componnetns/Gap\";\nimport ListMeassges from \"../../componnetns/ListMeassges\";\nimport { styles } from \"../../style/style\";\nimport EmojiSelector, { Categories } from \"react-native-emoji-selector\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport LottieView from \"lottie-react-native\";\nimport { Audio } from \"expo-av\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { PSUT_ChatroomApi } from \"../../api/routeApi\";\nimport { Cache } from \"../../helpers/cache\";\nimport bg from \"../../assets/chat_bg.png\";\n\nlet Player = new Audio.Sound();\n\nconst Meassging = ({ route }) => {\n  const nav = useNavigation();\n  if (!route?.params?.conversationId) nav.goBack();\n\n  const [messagesState, setMessagesState] = useState([]);\n  const [showEmoji, setShowEmoji] = useState(false);\n  const [emojiSelected, setEmojiSelected] = useState(\"\");\n  const [textMeassging, setTextMeassging] = useState(\"\");\n  const [image, setImage] = useState(null);\n  const [onRecored, setOnRecored] = useState(false);\n  const [visible, setVisible] = useState(false);\n  const [recoredFile, setRecoredFile] = useState(null);\n  const [recoredingUrl, setRecoredingUrl] = useState(null);\n  const flatRef = useRef(null);\n\n  const onChange = (text) => {\n    setTextMeassging(text);\n  };\n\n  // useEffect(() => {\n  //   console.log(route.params);\n  //   if (route.params.adminId === Cache.userData.id){\n\n  //   }\n  // }, []);\n\n  useEffect(() => {\n    setTextMeassging((pre) => pre + emojiSelected);\n  }, [emojiSelected]);\n\n  const showModal = () => setVisible(true);\n  const hideModal = () => setVisible(false);\n\n  const timerRef = useRef(null);\n  useEffect(() => {\n    getMessages();\n    timerRef.current = setInterval(() => getMessages(), 4000);\n\n    return () => clearInterval(timerRef.current);\n  }, []);\n\n  const getMessages = async () => {\n    try {\n      const { conversationId } = route.params;\n      const messages = await PSUT_ChatroomApi.GetMessagesInConversation(\n        conversationId\n      );\n\n      const userId = Cache.userData.id;\n      const data = messages.data.map((msg) => {\n        return {\n          id: msg.id,\n          sender: msg.sender.name,\n          message: msg.content,\n          sendingTime: msg.sendingTime,\n          isMe: userId === msg.sender.id,\n        };\n      });\n\n      if (messagesState.length !== data.length) setMessagesState(data);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  useEffect(() => {\n    scrollToIndex();\n  }, [messagesState]);\n\n  const getPickerPermissions = async () => {\n    const { status } = await ImagePicker.requestMediaLibraryPermissionsAsync();\n    if (status !== \"granted\") {\n      Alert(\n        \"تنبيه\",\n        \"للتتمكن من استخدام اختيار الصور من المعرض يجب ان تعطي الصلاحيه للوصول\",\n        [\n          {\n            text: \"اعادة طلب الصلاحية\",\n            onPress: () => getPickerPermissions(),\n            style: \"default\",\n          },\n          {\n            text: \"حسنا\",\n            style: \"cancel\",\n          },\n        ],\n        { cancelable: false }\n      );\n    } else pickImage();\n  };\n\n  const pickImage = async () => {\n    let result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.All,\n      allowsEditing: false,\n      aspect: [4, 3],\n      quality: 1,\n    });\n\n    console.log(result);\n\n    if (!result.cancelled) {\n      setImage(result.uri);\n    }\n  };\n\n  const startVoiceRecording = async () => {\n    try {\n      setOnRecored(true);\n      console.log(\"Requesting permissions..\");\n      await Audio.requestPermissionsAsync();\n      await Audio.setAudioModeAsync({\n        allowsRecordingIOS: true,\n        playsInSilentModeIOS: true,\n        shouldDuckAndroid: true,\n      });\n      console.log(\"Starting recording ....\");\n      const { recording } = await Audio.Recording.createAsync(\n        Audio.RECORDING_OPTIONS_PRESET_HIGH_QUALITY\n      );\n      setRecoredFile(recording);\n      console.log(\"Recording started\");\n    } catch (err) {\n      console.error(\"Failed to start recording\", err);\n    }\n  };\n\n  const stopRecording = async () => {\n    setOnRecored(false);\n    await recoredFile.stopAndUnloadAsync();\n    const uri = recoredFile.getURI();\n    setRecoredingUrl(uri);\n    showModal();\n    console.log(\"Recording stopped and stored at\", uri);\n  };\n\n  const playSound = async () => {\n    try {\n      const result = await Player.loadAsync({ uri: recoredingUrl }, {}, true);\n      const response = await Player.getStatusAsync();\n      Player.setOnPlaybackStatusUpdate((status) => {\n        if (status.didJustFinish) {\n          stopSound(recoredingUrl);\n        }\n      });\n      if (response.isLoaded) {\n        if (!response.isPlaying) Player.playAsync();\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const stopSound = async () => {\n    try {\n      const stusts = await Player.getStatusAsync();\n      console.log(\"stusts\", stusts);\n      if (stusts.isLoaded) {\n        await Player.pauseAsync();\n        recoredingUrl ? Player.unloadAsync() : undefined;\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const onPressSend = () => {\n    // if (!textMeassging) onRecored ? stopRecording() : startVoiceRecording();\n    // else {\n    const time = new Date();\n    const data = {\n      id: Math.random(),\n      sender: \"Me\",\n      message: textMeassging,\n      sendingTime: `T${time.getHours()}:${time.getMinutes()}:${time.getSeconds()}.`,\n      isMe: true,\n    };\n\n    const dto = {\n      content: textMeassging,\n      conversationId: route.params.conversationId,\n    };\n\n    setMessagesState([...messagesState, data]);\n    setTextMeassging(\"\");\n    scrollToIndex();\n\n    PSUT_ChatroomApi.sendMessage(dto);\n    // TODO: Send to the backend\n    // }\n  };\n\n  const scrollToIndex = () => {\n    if (messagesState.length - 1 < 0 || !flatRef.current) return;\n    try {\n      flatRef.current.scrollToIndex({\n        animated: true,\n        index: messagesState.length - 1,\n      });\n    } catch (e) {}\n  };\n\n  return (\n    <View style={[styles.container, { backgroundColor: \"#FFF\" }]}>\n      <Image\n        style={{\n          width: \"100%\",\n          height: \"100%\",\n          position: \"absolute\",\n          transform: [{ scale: 2 }],\n        }}\n        resizeMethod=\"auto\"\n        resizeMode=\"repeat\"\n        source={bg}\n      />\n      {/* TODO ADD CUSTOM HEADER */}\n      {!!image ? (\n        <View\n          style={{\n            flex: 1,\n            // backgroundColor: \"black\",\n            justifyContent: \"space-around\",\n          }}\n        >\n          <View\n            style={{\n              paddingHorizontal: 20,\n              display: \"flex\",\n              justifyContent: \"center\",\n              alignItems: \"center\",\n            }}\n          >\n            <Image\n              style={{ width: 300, height: 300 }}\n              source={{ uri: `${image}` }}\n            />\n          </View>\n\n          <View style={{ paddingHorizontal: 20 }}>\n            <Button\n              mode=\"contained\"\n              theme={{ roundness: 10 }}\n              labelStyle={{ fontFamily: \"AppNormal\" }}\n              contentStyle={styles.loginButton}\n              onPress={() => setImage(null)}\n            >\n              ارسال\n            </Button>\n          </View>\n        </View>\n      ) : (\n        <React.Fragment>\n          <FlatList\n            ref={flatRef}\n            data={messagesState}\n            style={{ height: \"10%\" }}\n            renderItem={({ item, index }) => (\n              <ListMeassges key={index} item={item} index={index} />\n            )}\n            keyExtractor={(item, index) =>\n              item?.id?.toString() ?? index.toString()\n            }\n          />\n          <View\n            style={{\n              padding: 10,\n              justifyContent: \"flex-end\",\n              alignItems: \"baseline\",\n            }}\n          >\n            <View style={styles.rowView}>\n              {onRecored ? (\n                <View style={{ width: \"80%\" }}>\n                  <LottieView\n                    loop={true}\n                    autoPlay={true}\n                    speed={0.65}\n                    style={{\n                      width: 100,\n                      height: 100,\n                      backgroundColor: \"white\",\n                    }}\n                    source={require(\"../../assets/jsonfile/loadingRecord.json\")}\n                  />\n                </View>\n              ) : (\n                <TextInput\n                  theme={{ roundness: 50 }}\n                  multiline={false}\n                  mode=\"outlined\"\n                  enablesReturnKeyAutomatically={true}\n                  keyboardType=\"twitter\"\n                  onChangeText={(text) => onChange(text)}\n                  value={textMeassging}\n                  left={\n                    <TextInput.Icon\n                      name={\"emoticon\"}\n                      onPress={() => setShowEmoji((prev) => !prev)}\n                      color={\"gray\"}\n                      style={{\n                        top: 5,\n                      }}\n                    />\n                  }\n                  selectionColor={\"#128C7E\"}\n                  style={[styles.textInputstyle, { width: \"85%\" }]}\n                />\n              )}\n              <Gap gapValue=\"3\" type=\"row\" />\n              <TouchableRipple onPress={onPressSend}>\n                <Avatar.Icon\n                  style={{ top: 7 }}\n                  size={45}\n                  icon={\"arrow-right-thick\"}\n                />\n              </TouchableRipple>\n            </View>\n          </View>\n        </React.Fragment>\n      )}\n      {showEmoji && (\n        <EmojiSelector\n          showSearchBar={false}\n          showSectionTitles={false}\n          category={Categories.emotion}\n          onEmojiSelected={(emoji) => setEmojiSelected(emoji)}\n        />\n      )}\n    </View>\n  );\n};\n\nexport default Meassging;\n"]},"metadata":{},"sourceType":"module"}